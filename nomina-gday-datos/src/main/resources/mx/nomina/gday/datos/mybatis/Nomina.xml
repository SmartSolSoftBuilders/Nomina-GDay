<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="mx.nomina.gday.dao.NominaDao">
	<resultMap type="Nomina" id="nominaResult">
		<result property="idNomina" column="ID_NOMINA"/>
		<result property="nombreCorto" column="NOMBRE_CORTO"/>
		<result property="provisionAguinaldo" column="PROVISION_AGUINALDO"/>
		<result property="provisionVacaciones" column="PROVISION_VACACIONES"/>
		<result property="provisionPrimaVacacional" column="PROVISION_PRIMA_VACACIONAL"/>
		<result property="diasAguinaldo" column="DIAS_AGUINALDO"/>
		<result property="porcPrimaVacacional" column="PORC_PRIMA_VACACIONAL"/>
		<result property="fondoAhorro" column="FONDO_AHORRO"/>
		<result property="facturaSubsidio" column="FACTURA_SUBSIDIO"/>
		<result property="ivaExento" column="IVA_EXENTO"/>
		<result property="reconoceAntiguedad" column="RECONOCE_ANTIGUEDAD"/>
		<result property="comisionCostSocial" column="COMISION_COST_SOCIAL"/>
		<result property="tipoPago" column="TIPO_PAGO"/>
		<result property="claseRiesgo" column="CLASE_RIESGO"/>
		<result property="registroPatronal" column="REGISTRO_PATRONAL"/>
		<result property="periodicidad" column="PERIODICIDAD"/>
		<result property="fechaContrato" column="FECHA_CONTRATO"/>
		<association property="intermediaria" column="ID_INTERMEDIARIA" javaType="Intermediaria" select="selectIntermediaria"/>
		<association property="patrona" column="ID_PATRONA" javaType="Patrona" select="selectPatrona"/>				
		<association property="esquema" column="ID_ESQUEMA" javaType="Esquema" select="selectEsquema"/>
		<association property="ejecutivo" column="ID_EJECUTIVO" javaType="Ejecutivo" select="selectEjecutivo"/>
		<association property="tipoCalendario" column="ID_CALENDARIO" javaType="TipoCalendario" select="selectTipoCalendario"/>
	</resultMap>
	
	<resultMap id="intermediariaResult" type="Intermediaria">
    	<id property="idIntermediaria" column="ID_INTERMEDIARIA"/>
		<result property="nombreIntermediaria" column="NOMBRE_INTERMEDIARIA"/>
		
							  		
	</resultMap>
	
	<resultMap id="patronaResult" type="Patrona">
    	<id property="idPatrona" column="ID_PATRONA"/>
		<result property="razonSocial" column="RAZON_SOCIAL"/>
		<result property="nombreCorto" column="NOMBRE_CORTO"/>
		<result property="esIntermediaria" column="ES_INTERMEDIARIA"/>
		<result property="tipoRegimen" column="TIPO_REGIMEN"/>
		<result property="folioMercantil" column="FOLIO_MERCANTIL"/>
		<result property="calleFiscal" column="CALLE_FISCAL"/>
		<result property="coloniaFiscal" column="COLONIA_FISCAL"/>
		<result property="numExteriorFiscal" column="NUM_EXTERIOR_FISCAL"/>
		<result property="numInteriorFiscal" column="NUM_INTERIOR_FISCAL"/>
		<result property="cpFiscal" column="CP_FISCAL"/>
		<result property="municipioFiscal" column="MUNICIPIO_FISCAL"/>
		<result property="estadoFiscal" column="ESTADO_FISCAL"/>
		<result property="fiscalNumPago" column="FISCAL_NUM_PAGO"/>
		<result property="telContacto" column="TEL_CONTACTO"/>
		<result property="actaNumero" column="ACTA_NUMERO"/>
		<result property="actaNotaria" column="ACTA_NOTARIA"/>
		<result property="actaFecha" column="ACTA_FECHA"/>
		<result property="actaNotario" column="ACTA_NOTARIO"/>
		<result property="actaCiudad" column="ACTA_CIUDAD"/>
		<result property="actaEstado" column="ACTA_ESTADO"/>	
</resultMap>
	
	<resultMap id="ejecutivoResult" type="Ejecutivo">
    	<id property="idEjecutivo" column="ID_EJECUTIVO"/>
		<result property="nombreEjecutivo" column="NOMBRE_EJECUTIVO"/>
		<result property="paternoEjecutivo" column="APP_PATERNO_EJECUTIVO"/> 
		<result property="maternoEjecutivo" column="APP_MATERNO_EJECUTIVO"/>			  		
	</resultMap>
	
	<resultMap id="esquemaResult" type="Esquema">
    	<id property="idEsquema" column="ID_ESQUEMA"/>
		<result property="nombreEsquema" column="NOMBRE_ESQUEMA"/>
					  		
	</resultMap>
	
	<resultMap id="tipoCalendarioResult" type="TipoCalendario">
    	<id property="idCalendario" column="ID_CALENDARIO"/>
		<result property="tipoCalendario" column="TIPO_CALENDARIO"/>
		<result property="siglas" column="SIGLAS"/>
		<result property="pr" column="PR"/>
			
	</resultMap>
	
	<select id="selectIntermediaria" parameterType="int" resultMap="intermediariaResult" resultType="Intermediaria">		 
		select * from "INTERMEDIARIA" where "ID_INTERMEDIARIA"=#{idIntermediaria} 	
	</select> 
	
	<select id="selectPatrona" parameterType="int" resultMap="patronaResult" resultType="Patrona">		 
		select * from "PATRONA" where "ID_PATRONA"=#{idPatrona} 	
	</select> 
	
	<select id="selectEjecutivo" parameterType="int" resultMap="ejecutivoResult" resultType="Ejecutivo">		 
		select * from "EJECUTIVO" where "ID_EJECUTIVO"=#{idEjecutivo} 	
	</select> 
	
	<select id="selectEsquema" parameterType="int" resultMap="esquemaResult" resultType="Esquema">		 
		select * from "ESQUEMA" where "ID_ESQUEMA"=#{idEsquema} 	
	</select> 
	
	
	<select id="selectTipoCalendario" parameterType="int" resultMap="tipoCalendarioResult" resultType="TipoCalendario">		 
		select * from "TIPO_CALENDARIO" where "ID_CALENDARIO"=#{idCalendario} 	
	</select> 

	<!-- Select para obtener la Nomina por idNomina -->
	<select id="obtenerNominaById" parameterType="int" resultMap="nominaResult" resultType="Nomina">		 
		select * from "NOMINA" where "ID_NOMINA"=#{idNomina} 	
	</select>
	
	<!-- Select para obtener la lista de todos las Nominas registradas -->
		<select id="obtenerNominas" parameterType="int" resultMap="nominaResult" resultType="Nomina">		 
		select * from "NOMINA" 	where "ID_CALENDARIO"= 1 AND "ID_ESQUEMA"= 1 AND "ID_INTERMEDIARIA"= 1
	</select>  

	<!-- Insert para guardar Nomina-->
	<insert id="agregarNomina" parameterType="Nomina" keyProperty="id">
		<selectKey keyProperty="id" resultType="long" order="BEFORE">
  		   	SELECT nextVal('sec_nomina')
  		</selectKey>
  		
  		INSERT INTO "NOMINA"(
            "ID_NOMINA", "ID_PATRONA", "ID_INTERMEDIARIA", "ID_ESQUEMA", "ID_EJECUTIVO", 
            "ID_CALENDARIO", "NOMBRE_CORTO", "PROVISION_AGUINALDO", 
            "PROVISION_VACACIONES", "PROVISION_PRIMA_VACACIONAL", "DIAS_AGUINALDO", 
            "PORC_PRIMA_VACACIONAL", "FONDO_AHORRO", "FACTURA_SUBSIDIO", 
            "IVA_EXENTO", "RECONOCE_ANTIGUEDAD", "COMISION_COST_SOCIAL", 
            "TIPO_PAGO", "CLASE_RIESGO", "REGISTRO_PATRONAL", "PERIODICIDAD", "TIPO_CALENDARIO", "FECHA_CONTRATO")
   	 	VALUES (#{id}, 1, 1, 1, 1, 1, #{nombreCorto},  #{provisionAguinaldo},  #{provisionVacaciones}, 
            #{provisionPrimaVacacional}, #{diasAguinaldo}, #{porcPrimaVacacional}, #{fondoAhorro}, 
            #{facturaSubsidio}, #{ivaExento}, #{reconoceAntiguedad}, 
            #{comisionCostSocial}, #{tipoPago}, #{claseRiesgo}, 
            #{registroPatronal}, #{periodicidad}, #{tipoCalendario.tipoCalendario}, date(#{fechaContrato}));	
	</insert>
	
<!-- Update para actualizar la Nomina seleccionada --> 
<update id="actualizarNomina" parameterType="Nomina">
	UPDATE "NOMINA"
   	SET 	"NOMBRE_CORTO"=#{nombreCorto}, "PROVISION_AGUINALDO"=#{provisionAguinaldo}, 
            "PROVISION_VACACIONES"=#{provisionVacaciones}, "PROVISION_PRIMA_VACACIONAL"=#{provisionPrimaVacacional}, "DIAS_AGUINALDO"=#{diasAguinaldo}, 
            "PORC_PRIMA_VACACIONAL"=#{porcPrimaVacacional}, "FONDO_AHORRO"=#{fondoAhorro}, "FACTURA_SUBSIDIO"=#{facturaSubsidio}, 
            "IVA_EXENTO"=#{ivaExento}, "RECONOCE_ANTIGUEDAD"=#{reconoceAntiguedad}, "COMISION_COST_SOCIAL"=#{comisionCostSocial}, 
            "TIPO_PAGO"=#{tipoPago}, "CLASE_RIESGO"=#{claseRiesgo}, "REGISTRO_PATRONAL"=#{registroPatronal}, "PERIODICIDAD"=#{periodicidad}, 
            "TIPO_CALENDARIO"=#{tipoCalendario.tipoCalendario}, "FECHA_CONTRATO"= date(#{fechaContrato})
 	WHERE "ID_NOMINA"=#{idNomina} AND "ID_PATRONA"= 1 AND "ID_INTERMEDIARIA"= 1 AND "ID_ESQUEMA"= 1 AND "ID_EJECUTIVO"= 1 AND "ID_CALENDARIO"=1 
</update>

<select id="obtenerNominasByIdRazonSocial" parameterType="int" resultMap="nominaResult" resultType="Nomina">
SELECT "NOMINA"."ID_NOMINA","NOMINA"."NOMBRE_CORTO", "NOMINA"."ID_ESQUEMA", "NOMINA"."ID_PATRONA", "NOMINA"."ID_INTERMEDIARIA", "NOMINA"."PERIODICIDAD", "NOMINA"."TIPO_PAGO", "NOMINA"."CLASE_RIESGO","NOMINA"."PORC_PRIMA_VACACIONAL","NOMINA"."FECHA_CONTRATO"
FROM "NOMINA" INNER JOIN "NOMINA_RAZON" ON  "NOMINA"."ID_NOMINA" = "NOMINA_RAZON"."ID_NOMINA" WHERE "NOMINA_RAZON"."ID_RAZON_SOCIAL" = #{id}</select>
</mapper>